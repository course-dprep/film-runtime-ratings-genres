---
title: "Data exploration"
output:
  pdf_document: default
date: "2025-10-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

---
title: "Data Exploration: Analysis of Combined IMDb Title Basics and Ratings Data"

author: "Group 6: Roos van den Berg, Jelle van der Eng, Dana Raats, Renata Serrano "

date: "2025-10-10"
output: pdf_document
---

```{r setup2, include=FALSE}

# 1. Load necessary packages
library(tidyverse)
library(dplyr)
library(readr)
library(here) 
library(knitr)

knitr::opts_chunk$set(
  echo = FALSE, 
  warning = FALSE,
  message = FALSE
  )
```

## 1. Introduction

This report provides a comprehensive analysis of two datasets from the Internet Movie Database (IMDb): `title.basics` and `title.ratings`. The raw data files were downloaded programmatically and eventually processed to create a joint data set.

The objective of this report is to:

-   Clearly define the structure and variables of the original data sets.

-   Provide summary statistics for key metrics.

## 2. Data Acquisition

The data was obtained using an R function that programmatically downloads the compressed TSV files from the IMDb data set website. This function checks for a local copy before downloading to avoid extra operations.

**Content of Original Files**

The two original sources contained the following information:

1.  `title.basics.tsv.gz`

| Variable | Category of data | Operationalization |
|--------------|-----------------------------|-----------------------------|
| `tconst`  | string | Unique alphanumeric identifier for the title |
| `titleType` | string | The type/format of the title |
| `primaryTitle`  | string | The most popular title used for promotional materials |
| `originalTitle`  | string | Original title, in the original language |
| `isAdult`  | boolean | 0: non-adult title; 1: adult title |
| `startYear`  | Integer | Release year of the title |
| `endYear`  | Integer | End year for TV series |
| `runtimeMinutes`  | Integer | Primary runtime in minutes. |
| `genres`  | string array | Up to three genres associated with the title |

2.  `title.ratings.tsv.gz`

    | Variable | Category of data | Operationalization |
    |----|----|----|
    | `tconst` | string | Unique alphanumeric identifier to link back to the basics file |
    | `averageRating` | Continuous | Weighted average of all user ratings |
    | `numVotes` | Integer | Total number of votes the title has received |

```{r, include=FALSE }
# Create a "data" directory if it doesn't already exist
if(!dir.exists("data")){dir.create("data")}

# This function checks for a local copy of a data file. If not found, it downloads the file before reading it into a data frame.
get_imdb_data <- function(url, file_name) {
  
  local_path <- file.path("data", file_name)
  
  # Download the file only if it doesn't already exist locally.
  if (!file.exists(local_path)) {
    options(timeout = 300)
    download.file(url = url, destfile = local_path, mode = "wb")
  }
  
  # Read the local zipped TSV file and return it as a tibble.
  read_tsv(local_path)
}

# Download Steps 

# URLs for the IMDb datasets
url_basics <- "https://datasets.imdbws.com/title.basics.tsv.gz"
url_ratings <- "https://datasets.imdbws.com/title.ratings.tsv.gz"

# Load the 'title.basics' and 'title.ratings' data using the custom function.
basics <- get_imdb_data(url_basics, "title.basics.tsv.gz")
ratings <- get_imdb_data(url_ratings, "title.ratings.tsv.gz")

# Prepare the names for the CSV output files (remove .gz part)
basics_csv <- "data/basics.csv"
ratings_csv <- "data/ratings.csv"

# Write the data frames to CSV (without the .gz part in the filename)
write_csv(basics, basics_csv)
write_csv(ratings, ratings_csv)

# Optionally, delete the original .tsv.gz files after conversion
file.remove("data/title.basics.tsv.gz")
file.remove("data/title.ratings.tsv.gz")
    
```

## 3. Data Exploration

This section provides an overview of the two raw IMDb data files: `title.basics` and `title.ratings`. The structure, rows, columns, and variable types will be explored and previews and summaries of the data will be provided to get a good understanding of what the raw data looks like. It is important to understand the content of the files before merging, cleaning, and filtering them.

### 3.1 Exploring `title.basics`

First, the `title.basics` dataset will be explored to understand its structure, variable types, and content. This exploration will help confirm that the data is correctly formatted and identify any potential issues that need to be solved. 

The number of rows and columns provides an overview of the size of the dataset.

```{r rows and columns of basics, echo=FALSE}
# Provide the number of rows and columns
cat("Number of rows:", nrow(basics), "\n")
cat("Number of columns:", ncol(basics), "\n")
```

The structure of the dataset shows the types of variables included and if they are correctly formatted.
```{r structure of basics, echo=FALSE}
# Provide the structure
str(basics)
```

A preview of the dataset provides insight into the contents.
```{r preview of basics, echo=FALSE}
head(basics)
```

The summary statistics provide information on numeric variables and help identify ranges, distributions, and potential outliers.
```{r summary of basics, echo=FALSE}
summary(basics)
```

Checking for missing values ensures knowledge on which variables might need cleaning before analysis.
```{r missing values of basics, echo=FALSE}
colSums(is.na(basics))
```

Genre is the moderator in this research and it is therefore important to gain some insight into this variable. The following table shows the top 5 most common genres in the dataset. 
```{r genres exploration, echo=FALSE}
library(dplyr)
library(tidyr)
library(knitr)

# Create table of top 5 genres
basics %>%
  filter(!is.na(genres)) %>%
  separate_rows(genres, sep = ",") %>%
  count(genres, sort = TRUE) %>%
  head(5) %>%
  kable(caption = "Top 5 Genres in the Dataset")
```

Runtime is the independent variable in this study, and its distribution is examined using a histogram.
```{r runtime exploration, echo=FALSE}
library(ggplot2)

# Histogram of movie runtime
basics <- basics %>%
  mutate(runtimeMinutes = as.numeric(runtimeMinutes)) %>%
  filter(!is.na(runtimeMinutes))

ggplot(basics, aes(x = runtimeMinutes)) +
  geom_histogram(binwidth = 10, fill = "pink", color = "black") +
  labs(title = "Distribution of Movie Runtime", x = "Runtime (minutes)", y = "Count") +
  theme_minimal()
```

### 3.2 Exploring `title.ratings`

Second, the `title.ratings` dataset will be explored in the same manner to gain deeper insights.

The number of rows and columns provides an overview of the size of the dataset.
```{r rows and columns of ratings, echo=FALSE}
# Provide the number of rows and columns
cat("Number of rows:", nrow(ratings), "\n")
cat("Number of columns:", ncol(ratings), "\n")
```

The structure of the dataset shows the types of variables included and if they are correctly formatted.
```{r structure of ratings, echo=FALSE}
# Provide the structure
str(ratings)
```

A preview of the dataset provides insight into the contents.
```{r preview of ratings, echo=FALSE}
head(ratings)
```

The summary statistics provide information on numeric variables and help identify ranges, distributions, and potential outliers.
```{r summary of ratings, echo=FALSE}
summary(ratings)
```

Checking for missing values ensures knowledge on which variables might need cleaning before analysis.
```{r missing values of ratings, echo=FALSE}
colSums(is.na(ratings))
```

Ratings is the dependent variable in this research and the following histogram will show how ratings are dsitributed in the dataset. 
```{r histogram ratings, echo=FALSE}
library(ggplot2)
ratings <- ratings %>%
  mutate(averageRating = as.numeric(averageRating))
ggplot(ratings, aes(x = averageRating)) +
  geom_histogram(binwidth = 0.5, fill = "skyblue", color = "black") +
  labs(title = "Distribution of IMDb Average Ratings",
       x = "Average Rating",
       y = "Count") +
  theme_minimal()
```

Having explored the dataset and its key variables, it is clear how to proceed with data cleaning and preparation for the analysis.

## 4. Preparation, Data Structure and Definition

**Preparation process**

The preparation process involved the following steps:

1.  Loading the `title.basics` and `title.ratings` data sets.

2.  The two data sets were merged using a left join on their common identifier, \``tconst`\`.

3.  The raw value \`\\N\` was interpreted as a missing value (\`NA\`).

4.  Filtering for movies where `titleType == "movie"`, discarding all TV shows, shorts, etc.

5.  Filtering for popularity where only movies that have received 250 or more votes (`numVotes >= 250`).

6.  Filtering by run time and genre, removing any movies with missing `runtimeMinutes` or `genres`. It also filters out outliers by only keeping movies with a run time between 30 and 250 minutes.

7.  \``startYear`\` and \``runtimeMinutes`\` were converted to a numeric format for analysis.

8.  Creating the variable `rating_category`, which classifies each movie into one of four categories ("Excellent", "Good", "Average", "Poor") based on its `averageRating`.

9.  Renaming the columns to be more intuitive (e.g., `tconst` becomes `movie_id`, `averageRating` becomes `avg_rating`) and selects a final, clean set of columns in a logical order.

10. Identifying the Top 3 Genres across the entire data set

11. Creating a dummy variable, for each one of the top genres

12. The script concludes by calling the `process_movie_data` function to execute all the steps above and produce the final, clean file.

After, merging, cleaning, and filtering the two raw IMDb datasets, the final data set `movies_clean` consists of about 93,000 observations. The variables included in the final dataset are presented in the following table:

| variable | type | category of data | operationalization | dataset |
|----|----|----|----|----|
| runtime_min | independent variable | metric | Run time of each movie in minutes | title.basics.tsv |
| rating_category | dependent variable | categorical | Audience rating of each movie: poor, average, good, or excellent | derived from avg_rating |
| genre dummies | moderator | categorical | Indicates whether the movie is of a certain genre | derived from genre_list |
| movie_id | identifier | numeric | ID of the movie | title.basics.tsv/title.ratings.tsv |
| avg_rating | source variable | metric | Audience rating of each movie on a scale of 0 to 10 | title.ratings.tsv |
| genre_list | source variable | categorical | Genre(s) of each movie | title.basics.tsv | 
| num_votes | control variable | numeric | Total number of ratings a movie received | title.ratings.tsv |


